<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>XO — Explore mídia</title>
  <!--
    XO by you 🫶
    Objetivo: galeria estilo Pinterest (apenas visualizar em tela cheia e baixar).
    Tecnologias: HTML + CSS + JS puros + supabase-js via CDN (sem Node, sem build).

    ⚙️ Como configurar (passos rápidos):
    1) No Supabase, crie um projeto e uma bucket pública chamada "xo-media" (ou outro nome e ajuste no JS).
       - Storage > Create bucket > Public.
       - Faça upload das suas imagens/gifs/vídeos via o painel do Supabase (não terá upload no site).
       - Dica: mantenha tudo na raiz da bucket para facilitar o .list() (sem subpastas).

    2) Pegue a URL do projeto e a chave ANON (Project Settings > API):
       - SUPABASE_URL (ex.: https://xxxx.supabase.co)
       - SUPABASE_ANON_KEY (chave pública – é normal ficar no front, pois o bucket é só leitura).

    3) Cole SUPABASE_URL e SUPABASE_ANON_KEY nas variáveis logo abaixo (em <script type="module">).

    4) (Opcional) Substitua os arquivos 
       - /logo.png (logo do site)
       - /bg.jpg   (imagem de fundo)
       por suas versões. Se não existir, tudo continua funcionando.

    5) Faça deploy no GitHub Pages:
       - Repositório com este index.html, logo.png e bg.jpg na raiz.
       - Settings > Pages > Deploy from a branch > main /root.

    Observação sobre privacidade: bucket pública significa leitura pública (download) sem login, como solicitado.
    Apenas você fará uploads pelo painel. Se quiser poder revogar facilmente links, troque para URLs assinadas.
  -->
  <style>
    :root {
      --xo-red: #e60023; /* vermelho Pinterest */
      --xo-red-600: #cc001f;
      --xo-bg: #ffffff;
      --xo-text: #111111;
      --xo-muted: #6b7280;
      --xo-card: #f8f8f8;
      --bg-image: url('bg.jpg'); /* troque por sua imagem */
    }
    [data-theme="dark"]{
      --xo-bg: #0b0b0c;
      --xo-text: #f2f2f2;
      --xo-muted: #9aa0a6;
      --xo-card: #141416;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--xo-bg) no-repeat fixed;
      color: var(--xo-text);
    }

    /* Fundo sutil com imagem editável */
    body::before{
      content: "";
      position: fixed; inset: 0;
      background-image: var(--bg-image);
      background-size: cover; background-position: center;
      opacity: 0.06; pointer-events: none; filter: saturate(0.7);
    }

    header{
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: blur(10px);
      background: color-mix(in oklab, var(--xo-bg) 75%, transparent);
      border-bottom: 1px solid color-mix(in oklab, var(--xo-text) 10%, transparent);
    }
    .wrap{ max-width: 1200px; margin: 0 auto; padding: 12px 16px; display:flex; align-items:center; gap:12px; }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--xo-text); }
    .brand img{ width:34px; height:34px; border-radius:8px; object-fit:cover; box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
    .brand span{ font-weight:800; letter-spacing:0.4px; font-size: 1.15rem; }

    .search{ flex:1; display:flex; }
    .search input{
      width: 100%; padding: 10px 12px; border-radius: 999px; border:1px solid transparent;
      background: var(--xo-card); color: var(--xo-text);
      outline: none;
    }
    .search input::placeholder{ color: var(--xo-muted); }

    .actions{ display:flex; align-items:center; gap:8px; }
    button.icon{
      border:1px solid color-mix(in oklab, var(--xo-text) 10%, transparent);
      background: var(--xo-card); color:var(--xo-text);
      padding:8px 12px; border-radius: 999px; cursor: pointer;
    }
    button.icon:hover{ transform: translateY(-1px); }

    /* Grade estilo Pinterest usando CSS Columns (masonry simples) */
    main{ max-width: 1400px; margin: 16px auto; padding: 0 12px 64px; }
    .grid{ column-width: 280px; column-gap: 16px; }

    .pin{
      display: inline-block; width: 100%; margin: 0 0 16px; break-inside: avoid;
      background: var(--xo-card); border-radius: 16px; overflow: hidden; position: relative;
      border: 1px solid color-mix(in oklab, var(--xo-text) 8%, transparent);
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    }
    .pin .media{ display:block; width:100%; height:auto; }
    .pin video.media{ width:100%; height:auto; display:block; }

    .pin .overlay{
      position:absolute; inset:0; display:flex; align-items:flex-start; justify-content:flex-end;
      gap:8px; padding:10px; opacity:0; transition:opacity .2s;
      background: linear-gradient(to bottom, rgba(0,0,0,.35), transparent 45%, transparent 70%, rgba(0,0,0,.25));
    }
    .pin:hover .overlay{ opacity: 1; }
    .btn{
      display:inline-flex; align-items:center; gap:8px; text-decoration:none; font-weight:700;
      border-radius: 999px; padding:8px 12px; border:0; cursor:pointer;
      background: var(--xo-red); color:white;
    }
    .btn:hover{ background: var(--xo-red-600); }
    .btn.secondary{ background: rgba(255,255,255,.92); color:#111; }

    .load-more{ display:block; margin: 24px auto; }

    /* Modal de visualização */
    .modal{ position: fixed; inset:0; background: rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; z-index:100; }
    .modal.open{ display:flex; }
    .modal .viewer{ max-width: 95vw; max-height: 88vh; }
    .modal img, .modal video{ max-width: 100%; max-height: 88vh; display:block; border-radius: 12px; }
    .modal .topbar{ position:absolute; top:16px; left:16px; right:16px; display:flex; justify-content:flex-end; gap:8px; }

    /* Footer */
    footer{ text-align:center; color:var(--xo-muted); padding:32px 12px; font-size:14px; }

    @media (max-width:600px){
      .search{ display:none; }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <a class="brand" href="#" aria-label="XO - início">
        <img src="logo.png" alt="XO logo" onerror="this.style.display='none'"/>
        <span>XO</span>
      </a>

      <div class="search">
        <input id="q" type="search" placeholder="Buscar por nome do arquivo…" />
      </div>

      <div class="actions">
        <button id="themeBtn" class="icon" title="Alternar tema">🌓</button>
        <a class="btn" style="text-decoration:none" href="#como-funciona" title="Sobre">Sobre</a>
      </div>
    </div>
  </header>

  <main>
    <div id="grid" class="grid" aria-live="polite"></div>
    <button id="loadMore" class="btn load-more">Carregar mais</button>

    <section id="como-funciona" style="max-width:900px;margin:40px auto 0; padding:0 12px;">
      <h2>Welcome</h2>
      <p>This is your gallery</p>
    </section>
  </main>

  <footer>
    <p>XO © <span id="year"></span> • Feito com Supabase • Sem cadastro, só curtir ✨</p>
  </footer>

  <!-- Modal de visualização em tela cheia -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-label="Visualizador">
    <div class="topbar">
      <a id="downloadBtn" class="btn secondary" href="#" download>⤓ Baixar</a>
      <button id="closeBtn" class="btn" aria-label="Fechar">Fechar ✕</button>
    </div>
    <div id="viewer" class="viewer"></div>
  </div>

  <!-- Supabase via CDN + App JS (sem Node) -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2.45.4";

    // 🔑 Cole suas credenciais aqui
    const SUPABASE_URL = "https://aqqwuibopikioqzvaxpm.supabase.co"; // <- troque
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFxcXd1aWJvcGlraW9xenZheHBtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxMjU2MjYsImV4cCI6MjA3MjcwMTYyNn0.Nea6TCznmm6yLmMy0WiTR2dcjq6cxDvFJ90oM04NLwM"; // <- troque

    // Nome da bucket (pública) com seus arquivos
    const BUCKET = "xo-media"; // ajuste se usar outro nome

    // Config do app
    const PAGE_SIZE = 30; // itens por página
    let currentPage = 0;
    let allItems = []; // cache para busca

    // Inicializa supabase
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Elementos
    const grid = document.getElementById('grid');
    const loadMoreBtn = document.getElementById('loadMore');
    const q = document.getElementById('q');
    const modal = document.getElementById('modal');
    const viewer = document.getElementById('viewer');
    const closeBtn = document.getElementById('closeBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    // Tema
    const themeBtn = document.getElementById('themeBtn');
    const savedTheme = localStorage.getItem('xo-theme');
    if (savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);
    themeBtn.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('xo-theme', next);
    });

    // Utilidades
    const IMAGE_EXT = ['jpg','jpeg','png','webp','gif','avif'];
    const VIDEO_EXT  = ['mp4','webm','ogv','ogg','mov'];

    function extOf(name){
      const i = name.lastIndexOf('.');
      return i >= 0 ? name.slice(i+1).toLowerCase() : '';
    }

    function isImage(name){ return IMAGE_EXT.includes(extOf(name)); }
    function isVideo(name){ return VIDEO_EXT.includes(extOf(name)); }

    function itemToNode(item){
      const { name } = item;
      const { data: pub } = supabase.storage.from(BUCKET).getPublicUrl(name);
      const url = pub.publicUrl; // bucket pública

      const card = document.createElement('figure');
      card.className = 'pin';
      card.tabIndex = 0;
      card.setAttribute('data-name', name);

      const overlay = document.createElement('div');
      overlay.className = 'overlay';
      const openBtn = document.createElement('button');
      openBtn.className = 'btn';
      openBtn.textContent = 'Abrir';
      overlay.appendChild(openBtn);

      const dl = document.createElement('a');
      dl.className = 'btn secondary';
      dl.textContent = 'Baixar';
      dl.href = url + '?download';
      dl.download = name;
      overlay.appendChild(dl);

      if (isImage(name) || name.toLowerCase().endsWith('.gif')){
        const img = document.createElement('img');
        img.src = url;
        img.alt = name;
        img.loading = 'lazy';
        img.className = 'media';
        card.appendChild(img);
      } else if (isVideo(name)){
        const vid = document.createElement('video');
        vid.src = url; // streaming simples pelo CDN
        vid.muted = true;
        vid.playsInline = true;
        vid.autoplay = false;
        vid.loop = true;
        vid.controls = false; // controles só no modal
        vid.className = 'media';
        card.appendChild(vid);
      } else {
        const unknown = document.createElement('div');
        unknown.style.padding = '24px';
        unknown.textContent = `Arquivo: ${name}`;
        card.appendChild(unknown);
      }

      card.appendChild(overlay);

      const open = () => openModal(url, name);
      card.addEventListener('click', open);
      card.addEventListener('keypress', (e)=>{ if(e.key==='Enter') open(); });
      openBtn.addEventListener('click', (e)=>{ e.stopPropagation(); open(); });

      return card;
    }

    function openModal(url, name){
      viewer.innerHTML = '';
      if (isImage(name) || name.toLowerCase().endsWith('.gif')){
        const img = document.createElement('img');
        img.src = url;
        img.alt = name;
        viewer.appendChild(img);
      } else if (isVideo(name)){
        const vid = document.createElement('video');
        vid.src = url;
        vid.controls = true;
        vid.autoplay = true;
        vid.className = 'viewer-media';
        viewer.appendChild(vid);
      }
      downloadBtn.href = url + '?download';
      downloadBtn.download = name;
      modal.classList.add('open');
    }

    function closeModal(){
      const v = viewer.querySelector('video');
      if (v) { v.pause(); v.src = ''; }
      modal.classList.remove('open');
      viewer.innerHTML = '';
    }

    modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });
    closeBtn.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.classList.contains('open')) closeModal(); });

    // Busca por nome (no cache local já carregado)
    q.addEventListener('input', ()=>{
      const term = q.value.trim().toLowerCase();
      render(term ? allItems.filter(x => x.name.toLowerCase().includes(term)) : allItems);
    });

    function render(items){
      grid.innerHTML = '';
      const frag = document.createDocumentFragment();
      for (const it of items){ frag.appendChild(itemToNode(it)); }
      grid.appendChild(frag);
    }

    async function loadPage(page){
      const from = page * PAGE_SIZE;
      const { data, error } = await supabase
        .storage
        .from(BUCKET)
        .list('', { limit: PAGE_SIZE, offset: from, sortBy: { column: 'updated_at', order: 'desc' } });
      if (error) { console.error(error); alert('Erro ao carregar itens do Supabase. Verifique a bucket/credenciais.'); return; }

      // Filtra somente tipos suportados
      const supported = (data || []).filter(x => isImage(x.name) || isVideo(x.name) || x.name.toLowerCase().endsWith('.gif'));
      allItems = allItems.concat(supported);

      // Re-render preservando busca se existir
      const term = q.value.trim().toLowerCase();
      const list = term ? allItems.filter(x => x.name.toLowerCase().includes(term)) : allItems;

      const frag = document.createDocumentFragment();
      for (const it of list.slice(-supported.length)) frag.appendChild(itemToNode(it));
      grid.appendChild(frag);

      // Se retornou menos que PAGE_SIZE, provavelmente acabou
      if (!data || data.length < PAGE_SIZE) {
        loadMoreBtn.style.display = 'none';
        observer && observer.disconnect();
      }
    }

    loadMoreBtn.addEventListener('click', async () => {
      currentPage += 1;
      await loadPage(currentPage);
    });

    // Auto-carregar ao rolar perto do fim
    const observer = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){ loadMoreBtn.click(); }
      });
    }, { rootMargin: '800px' });
    observer.observe(loadMoreBtn);

    // Start
    document.getElementById('year').textContent = new Date().getFullYear();

    // Primeira página
    loadPage(0);
  </script>
</body>
</html>

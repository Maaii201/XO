<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>XO â€” Explore mÃ­dia</title>
<style>
:root {
  --xo-red:#e60023; --xo-red-600:#cc001f; --xo-bg:#ffffff; --xo-text:#111; --xo-muted:#6b7280;
  --xo-card:#f8f8f8; --bg-image:url('bg.jpg');
}
[data-theme="dark"]{
  --xo-bg:#0b0b0c; --xo-text:#f2f2f2; --xo-muted:#9aa0a6; --xo-card:#141416;
}
*{box-sizing:border-box;}
html,body{height:100%;}
body{
  margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Noto Sans; 
  background:var(--xo-bg) no-repeat fixed; color:var(--xo-text);
}
body::before{
  content:""; position:fixed; inset:0; background-image:var(--bg-image);
  background-size:cover; background-position:center; opacity:0.06; pointer-events:none; filter:saturate(0.7);
}
header{
  position:sticky; top:0; z-index:50;
  backdrop-filter:blur(10px);
  background: color-mix(in oklab,var(--xo-bg) 75%,transparent);
  border-bottom:1px solid color-mix(in oklab,var(--xo-text) 10%,transparent);
}
.wrap{ max-width:1200px; margin:0 auto; padding:12px 16px; display:flex; align-items:center; gap:12px; }
.brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--xo-text); }
.brand span{ font-weight:800; letter-spacing:0.4px; font-size:1.15rem; }
.search{ flex:1; display:flex; }
.search input{
  width:100%; padding:10px 12px; border-radius:999px; border:1px solid transparent;
  background:var(--xo-card); color:var(--xo-text); outline:none;
}
.search input::placeholder{ color:var(--xo-muted); }
.actions{ display:flex; align-items:center; gap:8px; }
button.icon{
  border:1px solid color-mix(in oklab,var(--xo-text) 10%,transparent);
  background:var(--xo-card); color:var(--xo-text); padding:8px 12px; border-radius:999px; cursor:pointer;
}
button.icon:hover{ transform:translateY(-1px); }
main{ max-width:1400px; margin:16px auto; padding:0 12px 64px; }
.grid{ column-width:280px; column-gap:16px; }
.pin{
  display:inline-block; width:100%; margin:0 0 16px; break-inside:avoid;
  background:var(--xo-card); border-radius:16px; overflow:hidden; position:relative;
  border:1px solid color-mix(in oklab,var(--xo-text) 8%,transparent);
  box-shadow:0 6px 20px rgba(0,0,0,0.06);
}
.pin .media{ display:block; width:100%; height:auto; }
.pin video.media{ width:100%; height:auto; display:block; }
.pin .overlay{
  position:absolute; inset:0; display:flex; align-items:flex-start; justify-content:flex-end;
  gap:8px; padding:10px; opacity:0; transition:opacity .2s;
  background: linear-gradient(to bottom, rgba(0,0,0,.35), transparent 45%, transparent 70%, rgba(0,0,0,.25));
}
.pin:hover .overlay{ opacity:1; }
.btn{
  display:inline-flex; align-items:center; gap:8px; text-decoration:none; font-weight:700;
  border-radius:999px; padding:8px 12px; border:0; cursor:pointer;
  background:var(--xo-red); color:white;
}
.btn:hover{ background:var(--xo-red-600); }
.btn.secondary{ background:rgba(255,255,255,.92); color:#111; }
.load-more{ display:block; margin:24px auto; }
.modal{ position:fixed; inset:0; background:rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; z-index:100; }
.modal.open{ display:flex; }
.modal .viewer{ max-width:95vw; max-height:88vh; }
.modal img,.modal video{ max-width:100%; max-height:88vh; display:block; border-radius:12px; }
.modal .topbar{ position:absolute; top:16px; left:16px; right:16px; display:flex; justify-content:flex-end; gap:8px; }
footer{ text-align:center; color:var(--xo-muted); padding:32px 12px; font-size:14px; }
@media(max-width:600px){ .search{ display:none; } }
</style>
</head>
<body>
<header>
<div class="wrap">
<a class="brand" href="#">XO</a>
<div class="search"><input id="q" type="search" placeholder="Buscar por nome do arquivoâ€¦"/></div>
<div class="actions">
<button id="themeBtn" class="icon" title="Alternar tema">ðŸŒ“</button>
<a class="btn" href="#como-funciona" title="Sobre">Sobre</a>
</div>
</div>
</header>

<main>
<div id="grid" class="grid" aria-live="polite"></div>
<button id="loadMore" class="btn load-more">Carregar mais</button>

<section id="como-funciona" style="max-width:900px;margin:40px auto 0;padding:0 12px;">
<h2>Welcome</h2>
<p>Esta Ã© sua galeria</p>
</section>
</main>

<footer>
<p>XO Â© <span id="year"></span> â€¢ Feito com Supabase â€¢ Sem cadastro, sÃ³ curtir âœ¨</p>
</footer>

<div id="modal" class="modal" role="dialog" aria-modal="true" aria-label="Visualizador">
<div class="topbar">
<a id="downloadBtn" class="btn secondary" href="#" download>â¤“ Baixar</a>
<button id="closeBtn" class="btn" aria-label="Fechar">Fechar âœ•</button>
</div>
<div id="viewer" class="viewer"></div>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2.45.4";

const SUPABASE_URL = "https://aqqwuibopikioqzvaxpm.supabase.co"; 
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFxcXd1aWJvcGlraW9xenZheHBtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxMjU2MjYsImV4cCI6MjA3MjcwMTYyNn0.Nea6TCznmm6yLmMy0WiTR2dcjq6cxDvFJ90oM04NLwM";
const BUCKET = "xo-media";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const grid = document.getElementById('grid');
const loadMoreBtn = document.getElementById('loadMore');
const q = document.getElementById('q');
const modal = document.getElementById('modal');
const viewer = document.getElementById('viewer');
const closeBtn = document.getElementById('closeBtn');
const downloadBtn = document.getElementById('downloadBtn');

const themeBtn = document.getElementById('themeBtn');
const savedTheme = localStorage.getItem('xo-theme');
if(savedTheme) document.documentElement.setAttribute('data-theme',savedTheme);
themeBtn.addEventListener('click',()=>{ 
  const current=document.documentElement.getAttribute('data-theme');
  const next=current==='dark'?'light':'dark';
  document.documentElement.setAttribute('data-theme',next);
  localStorage.setItem('xo-theme',next);
});

const IMAGE_EXT=['jpg','jpeg','png','webp','gif','avif'];
const VIDEO_EXT=['mp4','webm','ogv','ogg','mov'];
let allItems=[];

function extOf(name){ const i=name.lastIndexOf('.'); return i>=0?name.slice(i+1).toLowerCase():''; }
function isImage(name){ return IMAGE_EXT.includes(extOf(name)); }
function isVideo(name){ return VIDEO_EXT.includes(extOf(name)); }

function itemToNode(item){
  const {name}=item;
  if(!name) return null;
  const {data:pub}=supabase.storage.from(BUCKET).getPublicUrl(name);
  const url=pub.publicUrl;

  const card=document.createElement('figure');
  card.className='pin';
  card.tabIndex=0;
  card.setAttribute('data-name',name);

  const overlay=document.createElement('div');
  overlay.className='overlay';
  const openBtn=document.createElement('button');
  openBtn.className='btn';
  openBtn.textContent='Abrir';
  overlay.appendChild(openBtn);

  const dl=document.createElement('a');
  dl.className='btn secondary';
  dl.textContent='Baixar';
  dl.href=url+'?download';
  dl.download=name;
  overlay.appendChild(dl);

  if(isImage(name)||name.toLowerCase().endsWith('.gif')){
    const img=document.createElement('img');
    img.src=url; img.alt=name; img.loading='lazy'; img.className='media';
    card.appendChild(img);
  } else if(isVideo(name)){
    const vid=document.createElement('video');
    vid.src=url; vid.muted=true; vid.playsInline=true; vid.autoplay=false; vid.loop=true; vid.controls=false; vid.className='media';
    card.appendChild(vid);
  } else {
    const unknown=document.createElement('div');
    unknown.style.padding='24px';
    unknown.textContent=`Arquivo: ${name}`;
    card.appendChild(unknown);
  }

  card.appendChild(overlay);
  const open=()=>openModal(url,name);
  card.addEventListener('click',open);
  card.addEventListener('keypress',e=>{if(e.key==='Enter') open();});
  openBtn.addEventListener('click',e=>{ e.stopPropagation(); open(); });

  return card;
}

function openModal(url,name){
  viewer.innerHTML='';
  if(isImage(name)||name.toLowerCase().endsWith('.gif')){
    const img=document.createElement('img');
    img.src=url; img.alt=name; viewer.appendChild(img);
  } else if(isVideo(name)){
    const vid=document.createElement('video');
    vid.src=url; vid.controls=true; vid.autoplay=true; vid.className='viewer-media'; viewer.appendChild(vid);
  }
  downloadBtn.href=url+'?download';
  downloadBtn.download=name;
  modal.classList.add('open');
}

function closeModal(){
  const v=viewer.querySelector('video');
  if(v){v.pause();v.src='';}
  modal.classList.remove('open');
  viewer.innerHTML='';
}

modal.addEventListener('click',e=>{if(e.target===modal) closeModal();});
closeBtn.addEventListener('click',closeModal);
document.addEventListener('keydown',e=>{if(e.key==='Escape' && modal.classList.contains('open')) closeModal();});

q.addEventListener('input',()=>{
  const term=q.value.trim().toLowerCase();
  render(term?allItems.filter(x=>x.name.toLowerCase().includes(term)):allItems);
});

function render(items){
  grid.innerHTML='';
  const frag=document.createDocumentFragment();
  for(const it of items){
    const node=itemToNode(it);
    if(node) frag.appendChild(node);
  }
  grid.appendChild(frag);
  if(items.length===0){
    grid.innerHTML='<p style="text-align:center;color:var(--xo-muted);">Nenhum arquivo encontrado.</p>';
  }
}

async function loadPage(){
  const {data,error}=await supabase.storage.from(BUCKET).list('',{sortBy:{column:'created_at',order:'desc'}});
  if(error){console.error("Erro Supabase:",error.message); return;}
  allItems=(data||[]).filter(x=>isImage(x.name)||isVideo(x.name)||x.name.toLowerCase().endsWith('.gif'));
  render(allItems);
  loadMoreBtn.style.display='none';
}

document.getElementById('year').textContent=new Date().getFullYear();
loadPage();
</script>
</body>
</html>
